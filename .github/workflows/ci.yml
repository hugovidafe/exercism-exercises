name: ğŸ’š CI

on:
  push:
  workflow_call:

permissions: write-all

jobs:
  typescript:
    name: ğŸ’™ TypeScript
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@main
        with:
          fetch-depth: 0
          ref: ${{ github.head_ref }}

      - name: ğŸ’½ Setup Node.js
        uses: actions/setup-node@main
        with:
          node-version: 'lts/*'

      - name: ğŸ“€ Install dependencies
        uses: for d in ./typescript/*/ ; do (cd "$d" && yarn install --immutable --inline-builds); done

      - name: âœ… Check
        run: for d in ./typescript/*/ ; do (cd "$d" && yarn lint); done

      - name: ğŸ§ª Tests
        run: for d in ./typescript/*/ ; do (cd "$d" && yarn test); done

  java:
    name: ğŸ§¡ Java
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@main
        with:
          fetch-depth: 0
          ref: ${{ github.head_ref }}

      - name: ğŸ’½ Setup Java
        uses: actions/setup-java@main
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'gradle'
          check-latest: true

      - name: ğŸ§ª Tests
        run: for d in ./java/*/ ; do (cd "$d" && gradle test); done
